// Generated by CoffeeScript 1.7.1
(function() {
  "use strict";

  /*
  CompanyTableCtrl
  table view of entity
  save pagination and filter params in session?
   */
  var module;

  module = angular.module("maboss.CompanyTableCtrl", []);

  module.controller("CompanyTableCtrl", [
    "$scope", "$routeParams", "$log", "contextService", "dataService", "translationService", "helpers", function($scope, $routeParams, $log, contextService, dataService, translationService, helpers) {
      var fetch, init, _t;
      $scope.table = "company";
      $scope.pkey = "company";
      _t = translationService.translate;
      init = function() {
        return $log.debug("init");
      };

      /*
      init table columns
       */
      $scope.columns = [
        {
          data: "company",
          title: _t("company"),
          orderable: true,
          visible: true,
          render: function(data, type, row) {
            return "<a href=\"#/facility.form/" + data + "\">" + data + "</a>";
          }
        }, {
          data: "texths",
          title: _t("texths"),
          orderable: true,
          visible: true
        }, {
          data: "currencycode",
          title: _t("currencycode"),
          orderable: true,
          visible: true
        }, {
          data: "code_format_type",
          title: _t("code_format_type"),
          orderable: true,
          visible: true
        }, {
          data: "domainmanagerid",
          title: _t("domainmanagerid"),
          orderable: true,
          visible: true
        }, {
          data: "objectclass",
          title: _t("objectclass"),
          orderable: true,
          visible: true
        }, {
          data: "modifiedon",
          title: _t("modifiedon"),
          visible: false
        }, {
          data: "createdon",
          title: _t("createdon"),
          visible: false
        }, {
          data: "createdby",
          title: _t("createdby"),
          orderable: false,
          visible: false
        }
      ];

      /*
       * call service
       */
      fetch = function(data, callback) {
        var cols, i, params;
        cols = [];
        i = void 0;
        i = 0;
        while (i < data.columns.length) {
          cols.push(data.columns[i].data);
          i++;
        }
        params = {
          table: $scope.table,
          pkey: $scope.pkey,
          cols: cols,
          orderby: [parseInt(data.order[0].column) + 1, data.order[0].dir].join(" "),
          offset: data.start,
          domain: [[[cols[0], "ilike", data.search.value + "%"]]],
          limit: data.length,
          languageid: "1033"
        };
        dataService.fetch(params).then((function(result) {
          $log.debug("fetch success", result);
          result.recordsTotal = result.total;
          result.recordsFiltered = result.count;
          $log.debug(JSON.stringify(result));
          callback(result);
        }), function(result) {
          var rdata;
          $log.error("error", result);
          rdata = {
            data: []
          };
          callback(rdata);
        });
      };

      /*
       *    table config
       */
      $("#main_table").dataTable({
        serverSide: true,
        aaSorting: [[0, "desc"]],
        sPaginationType: "bootstrap",
        oLanguage: {
          sSearch: "Search",
          sLengthMenu: "_MENU_"
        },
        ajax: function(data, callback, setting) {
          fetch(data, callback);
        },
        columns: $scope.columns,
        columnDefs: {
          render: function(data, type, row) {
            return data + " (" + row[3] + ")";
          }
        }
      });

      /*
      delete
       */
      $scope["delete"] = function() {
        var params;
        params = {
          table: $scope.table,
          ids: []
        };
        if (params.ids.length > 0) {
          return dataService["delete"](params);
        }
      };

      /*
      init
       */
      return init();
    }
  ]);

}).call(this);
