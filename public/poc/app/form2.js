// Generated by CoffeeScript 1.7.1
(function() {
  "use strict";

  /*
   * Company form
   */
  angular.module("fbpoc.CompanyFormCtrl", []).controller("CompanyFormCtrl", [
    "$scope", "$routeParams", "$log", "$builder", "$validator", "contextService", "dataService", "translationService", "helpers", function($scope, $routeParams, $log, $builder, $validator, contextService, dataService, translationService, helpers) {
      var get_kv, init, init_edit, init_select, name_pos, o_code_format_type, o_company, o_currencycode, o_domainmanagerid, o_objectclass, o_texths, obj_list, _t;
      $scope.table = "company";
      $scope.pkey = 'company';
      _t = translationService.translate;
      $scope.system = {
        modifiedon: null,
        modifiedby: null,
        createdon: null,
        createdby: null,
        rowversion: null
      };
      name_pos = {};
      o_company = {
        name: "company",
        component: "sampleInput",
        label: _t("company"),
        description: "",
        placeholder: _t("company_ph"),
        required: true,
        editable: false
      };
      o_texths = {
        name: "texths",
        component: "sampleInput",
        label: _t("texths"),
        description: "",
        placeholder: _t("texths_ph"),
        required: false,
        editable: false
      };
      o_currencycode = {
        name: "currencycode",
        component: "select4",
        label: _t("currencycode"),
        description: "",
        placeholder: _t("currencycode_ph"),
        required: false,
        editable: false
      };
      o_code_format_type = {
        name: "code_format_type",
        component: "select4",
        label: _t("code_format_type"),
        description: "",
        placeholder: _t("code_format_type_ph"),
        required: false,
        editable: false
      };
      o_domainmanagerid = {
        name: "domainmanagerid",
        component: "sampleInput",
        label: _t("domainmanagerid"),
        description: "",
        placeholder: _t("domainmanagerid_ph"),
        required: false,
        editable: false
      };
      o_objectclass = {
        name: "objectclass",
        component: "sampleInput",
        label: _t("objectclass"),
        description: "",
        placeholder: _t("objectclass_ph"),
        required: false,
        editable: false
      };
      obj_list = [o_company, o_texths, o_currencycode, o_code_format_type, o_domainmanagerid, o_objectclass];
      init_edit = function() {
        var id;
        id = $routeParams;
        if (id) {
          return $scope.get();
        }
      };
      init = function() {
        var context, j, obj;
        context = contextService.get();
        j = 0;
        $scope.zmodel = [];
        $scope.defaultValue = {};
        j = 0;
        while (j < obj_list.length) {
          obj = obj_list[j];
          name_pos[obj.name] = j;
          if ("default_" in obj) {
            $scope.defaultValue[j] = obj.default_;
          }
          $builder.addFormObject("zform", obj);
          j++;
        }
        $scope.zform = $builder.forms["zform"];
        init_select();
        init_edit();
      };

      /*
       *get options for select
      get_kv = (field) ->
      
          dataService.getkv(params).then(
              (data) ->
                  $log.debug(data)
              ,
              (result) ->
                  $log.debug("error", data)
          
          )
      
       * initial all select field
      init_select = ->
          
          select_fields = []
          
          for field in select_fields
              
              get_kv(field)
       */
      get_kv = function(table, column) {
        return [table, column];
      };
      init_select = function() {
        get_kv("currency", "currencycode");
        get_kv("code_format_type", "id");
      };

      /*
      set_sysdata = (data) ->
          
          cols = ["modifiedon","modifiedby","createdon","createdby","rowversion"]
          
          for col in cols
              $scope.system[col] = data[col]
       */
      $scope.get = function() {
        dataService.get(params).then(function(data) {
          $log.debug(data);
          return $scope.defaultValue[0] = "abc";
        }, function(result) {
          return $log.debug("error", result);
        });
      };
      $scope.refresh = function() {
        return $scope.get();
      };
      $scope.save = function() {
        var context, fields, item, params, _i, _len, _ref;
        fields = {};
        if ($scope.system.rowversion) {
          fields.rowversion = $scope.system.rowversion;
        }
        context = contextService.get();

        /*
        {
            languageid:1033
            user:'idea'
        }
         */
        _ref = $scope.zmodel;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          item = _ref[_i];
          if (item.value.length === 0) {
            fields[item.name] = null;
          } else {
            fields[item.name] = item.value;
          }
        }
        params = {
          table: $scope.table,
          pkey: $scope.pkey,
          columns: fields,
          context: context
        };
        $log.debug(fields);
        $log.debug(params);
        dataService.save(params).then(function(data) {
          var pos;
          $scope.system = data.returning[0];
          pos = name_pos['company'];
          $builder.forms["zform"][pos].readonly = true;
          return $log.debug(data);
        }, function(reason) {
          return $log.debug("error", reason);
        });
      };
      return init();
    }
  ]);

}).call(this);
