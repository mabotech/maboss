// Generated by CoffeeScript 1.7.1

/*
FacilityListCtrl
view of engity list
save pagination and filter params in session?
 */

(function() {
  angular.module("maboss.FacilityTableCtrl", []).controller("FacilityTableCtrl", [
    "$scope", "$routeParams", "$http", "sessionService", "dataService", "common", function($scope, $routeParams, $http, sessionService, dataService, common) {
      var list, _t;
      $scope.table = "facility";
      $scope.pkey = "facility";
      _t = function(msgid) {
        return "更新时间";
      };
      $scope.columns = [
        {
          data: "facility",
          title: "Facility Code",
          render: function(data, type, row) {
            return "<a href=\"#/facility.form/" + data + "\">" + data + "</a>";
          }
        }, {
          data: "texths",
          title: "Facility"
        }, {
          data: "company",
          orderable: false,
          title: "公司",
          name: "company"
        }, {
          data: "modifiedon",
          title: _t("modifiedon")
        }, {
          data: "createdon",
          title: "Created On"
        }, {
          data: "createdby",
          title: "Created By",
          orderable: false
        }
      ];
      list = function(data, callback) {
        var cols, i, params;
        cols = [];
        i = 0;
        while (i < data.columns.length) {
          cols.push(data.columns[i].data);
          i++;
        }
        params = {
          table: $scope.table,
          pkey: $scope.pkey,
          cols: cols,
          orderby: [parseInt(data.order[0].column) + 1, data.order[0].dir].join(" "),
          offset: data.start,
          domain: [[[cols[0], "ilike", data.search.value + "%"]]],
          limit: data.length,
          languageid: "1033"
        };
        dataService.list(params).then((function(result) {
          var rdata;
          rdata = {
            data: result.data,
            recordsTotal: result.total,
            recordsFiltered: result.count
          };
          callback(rdata);
        }), function(result) {
          var rdata;
          rdata = {
            data: []
          };
          callback(rdata);
        });
      };
      return $("#main_table").dataTable({
        serverSide: true,
        aaSorting: [[0, "desc"]],
        sPaginationType: "bootstrap",
        oLanguage: {
          sSearch: "Search",
          sLengthMenu: "_MENU_"
        },
        ajax: function(data, callback, setting) {
          list(data, callback);
        },
        columns: $scope.columns,
        columnDefs: {
          render: function(data, type, row) {
            return data + " (" + row[3] + ")";
          }
        }
      });
    }
  ]);

}).call(this);
