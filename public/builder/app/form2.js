// Generated by CoffeeScript 1.7.1
(function() {
  "use strict";
  angular.module("fbpoc.CompanyFormCtrl", []).controller("CompanyFormCtrl", [
    "$scope", "$builder", "$validator", "dataService", "$log", function($scope, $builder, $validator, dataService, $log) {
      var init, init_select, name_pos, o_code_format_type, o_company, o_currencycode, o_domainmanagerid, o_objectclass, o_texths, obj_list, table;
      table = "company";
      $scope.system = {
        modifiedon: null,
        modifiedby: null,
        createdon: null,
        createdby: null,
        rowversion: null
      };
      name_pos = {};
      o_company = {
        name: "company",
        component: "sampleInput",
        label: "company",
        description: "",
        placeholder: "company",
        required: true,
        editable: false
      };
      o_texths = {
        name: "texths",
        component: "sampleInput",
        label: "texths",
        description: "",
        placeholder: "texths",
        required: false,
        editable: false
      };
      o_currencycode = {
        name: "currencycode",
        component: "select4",
        label: "currencycode",
        description: "",
        placeholder: "currencycode",
        required: false,
        editable: false
      };
      o_code_format_type = {
        name: "code_format_type",
        component: "select4",
        label: "code_format_type",
        description: "",
        placeholder: "code_format_type",
        required: false,
        editable: false
      };
      o_domainmanagerid = {
        name: "domainmanagerid",
        component: "sampleInput",
        label: "domainmanagerid",
        description: "",
        placeholder: "domainmanagerid",
        required: false,
        editable: false
      };
      o_objectclass = {
        name: "objectclass",
        component: "sampleInput",
        label: "objectclass",
        description: "",
        placeholder: "objectclass",
        required: false,
        editable: false
      };
      obj_list = [o_company, o_texths, o_currencycode, o_code_format_type, o_domainmanagerid, o_objectclass];
      init_select = function() {};
      init = function() {
        var j, obj;
        j = 0;
        $scope.zmodel = [];
        $scope.defaultValue = {};
        j = 0;
        while (j < obj_list.length) {
          obj = obj_list[j];
          name_pos[obj.name] = j;
          if ("default_" in obj) {
            $scope.defaultValue[j] = obj.default_;
          }
          $builder.addFormObject("zform", obj);
          j++;
        }
        $scope.zform = $builder.forms["zform"];
        init_select();
      };
      $scope.submit = function() {
        var context, fields, item, params, _i, _len, _ref;
        fields = {};
        if ($scope.system.rowversion) {
          fields.rowversion = $scope.system.rowversion;
        }
        context = {
          languageid: 1033,
          user: 'idea'
        };
        _ref = $scope.zmodel;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          item = _ref[_i];
          if (item.value.length === 0) {
            fields[item.name] = null;
          } else {
            fields[item.name] = item.value;
          }
        }
        params = {
          table: 'company',
          pkey: 'company',
          columns: fields,
          context: context
        };
        $log.debug(fields);
        $log.debug(params);
        return dataService.save(params).then(function(data) {
          var pos;
          $scope.system = data.returning[0];
          pos = name_pos['company'];
          $builder.forms["zform"][pos].readonly = true;
          return $log.debug(data);
        }, function(reason) {
          return $log.debug("error", reason);
        });
      };
      return init();
    }
  ]);

}).call(this);
